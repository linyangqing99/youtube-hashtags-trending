# YouTube Hashtag 分析平台 - 开发 TODO

## 🎯 项目总览

基于设计稿 MVP 功能，构建专业的 YouTube hashtag 分析平台，专注于 hashtag 趋势追踪、热力图可视化和数据分析功能。包含 YouTube API 集成、实时数据处理、智能 hashtag 分析和商业化功能。

---

## 📋 阶段一：YouTube Data API 集成 ✅

### 1.1 API 配置和测试 ✅
- [x] **申请 YouTube Data API v3 密钥**
  - [x] 在 Google Cloud Console 创建项目
  - [x] 启用 YouTube Data API v3
  - [x] 获取并配置 API 密钥（已存储在环境变量中）
  - [x] 设置 API 配额监控

- [x] **API 连接测试**
  - [x] 创建 API 客户端封装类
  - [x] 测试基础视频列表获取
  - [x] 测试分页数据获取（支持4页200个视频）
  - [x] 实现错误处理和重试机制

### 1.2 API 查询机制 ✅
- [x] **热门视频获取**
  - [x] 实现获取热门视频列表（mostPopular）
  - [x] 支持按地区/类别筛选（美国地区已实现）
  - [x] 支持指定视频详情字段（snippet, statistics）
  - [x] 优化 API 调用量（使用curl解决代理问题）

- [x] **分页数据获取**
  - [x] 实现多页数据循环获取（4页200个视频）
  - [x] 测试最大可查询页数（quota限制为200个视频）
  - [x] 实现断点续传机制（通过pageToken）
  - [x] 添加获取进度显示

### 1.3 定时任务系统
- [ ] **调度器设计**
  - [ ] 选择任务调度库（node-cron / bull）
  - [ ] 设计定时任务配置（12小时间隔）
  - [ ] 实现任务状态监控
  - [ ] 添加任务失败重试

- [ ] **数据同步逻辑**
  - [ ] 增量数据获取策略
  - [ ] 重复数据检测和去重
  - [ ] 数据完整性验证
  - [ ] 同步日志记录

---

## 📋 阶段二：数据库设计和实现 ✅

### 2.1 数据库选型和设计 ✅
- [x] **数据库选择**
  - [x] 评估数据库选项（选择 Supabase PostgreSQL）
  - [x] 设计数据库连接配置（Supabase MCP集成）
  - [x] 实现连接池管理（Supabase自带）
  - [x] 配置数据库索引

- [x] **数据表结构设计** ✅
  ```sql
  -- 视频基础信息表 ✅
  videos (
    id, video_id, title, description, channel_title,
    published_at, view_count, like_count, comment_count,
    tags, created_at, updated_at
  )

  -- Hashtag信息表 ✅
  hashtags (
    id INTEGER, name, count, created_at, updated_at
  )

  -- 视频hashtag关联表 ✅
  video_hashtags (
    id, video_id, hashtag_id, source, created_at
  )

  -- 视频快照时间序列表 ✅
  video_snapshots (
    id, video_id, view_count, like_count, comment_count,
    snapshot_date, ranking_position, created_at
  )

  -- Hashtag趋势时间序列表 ✅
  hashtag_trends (
    id, hashtag_id, mention_count, unique_videos, total_views,
    trend_date, region_code, ranking_position, created_at
  )

  -- API查询记录表 ✅
  api_queries (
    id, query_type, region_code, page_number, total_results,
    query_date, response_time_ms, success, created_at
  )
  ```

### 2.2 数据访问层
- [ ] **ORM/数据库工具**
  - [ ] 选择 ORM 工具（Prisma / TypeORM / Sequelize）
  - [ ] 配置数据库模型定义
  - [ ] 实现数据库迁移脚本
  - [ ] 添加种子数据初始化

- [ ] **数据操作封装**
  - [ ] 实现视频数据 CRUD 操作
  - [ ] 实现标签数据 CRUD 操作
  - [ ] 实现复杂查询逻辑
  - [ ] 添加数据验证和约束

### 2.3 数据入库流程 ✅
- [x] **数据处理管道**
  - [x] API 数据格式转换（YouTube API → 数据库格式）
  - [x] 数据清洗和标准化（hashtag提取、验证）
  - [x] 批量数据插入优化（200个视频+268个hashtags）
  - [x] 事务处理和回滚机制

- [x] **数据完整性保证**
  - [x] 重复数据检测和处理（upsert操作）
  - [x] 数据关联一致性检查（外键约束）
  - [x] 失败数据重试机制（错误日志记录）
  - [x] 数据备份策略（时间序列存储）

---

## 📈 项目进度总结

### ✅ 已完成的核心功能
1. **YouTube Data API 集成** - 完整的多页数据获取
2. **Supabase 数据库集成** - 6张表的完整设计
3. **Hashtag 提取算法** - 智能识别和标准化
4. **时间序列数据存储** - 视频快照和hashtag趋势
5. **数据收集管道** - 200个视频+268个hashtags的完整数据
6. **环境变量安全配置** - API密钥管理
7. **代理网络问题解决** - curl方案
8. **数据统计修复** - hashtag使用量正确计算

### 🔄 正在进行的任务
- **时间序列数据创建** - 正在运行，创建首批历史数据

### 📊 当前数据规模
- **视频数量**: 200个美国地区热门视频
- **Hashtag数量**: 268个独特hashtags
- **关联关系**: 328个视频-hashtag关联
- **时间序列**: 正在创建中

---

## 📋 阶段三：Hashtag 数据处理和分析 ✅

### 3.1 Hashtag 提取和统计 ✅
- [x] **Hashtag 提取算法**
  - [x] 从 YouTube 视频 tags 字段提取 hashtag
  - [x] 从视频标题和描述中识别 hashtag 模式（正则表达式）
  - [x] 实现 hashtag 标准化处理（去除#号、转小写等）
  - [x] 建立 hashtag 规范性验证规则（长度2-50字符）

- [x] **使用量统计计算**
  - [x] 实时计算每个 hashtag 的总提及次数（通过count字段）
  - [x] 统计每个 hashtag 关联的独特视频数量
  - [x] 计算关联视频的总观看数
  - [x] 生成基于当前数据的统计信息

### 3.2 热力图数据生成
- [ ] **活动级别分类**
  - [ ] 根据使用量将 hashtag 活动分为 4 个级别
  - [ ] Low: < 50% 平均值
  - [ ] Medium: 50%-100% 平均值
  - [ ] Hot: 100%-200% 平均值
  - [ ] Very Hot: > 200% 平均值

- [ ] **趋势变化计算**
  - [ ] 计算每个 hashtag 的 7天增长率
  - [ ] 生成趋势上升/下降指标
  - [ ] 计算同比/环比变化
  - [ ] 检测异常趋势波动

### 3.3 Hot Trending 算法
- [ ] **热度评分系统**
  - [ ] 设计综合热度计算公式：`score = (mentions * 0.4) + (growth * 0.3) + (recency * 0.2) + (consistency * 0.1)`
  - [ ] 实现实时热度计算
  - [ ] 添加时间衰减因子
  - [ ] 优化算法性能

- [ ] **Top Hashtag 排行**
  - [ ] 按热度评分排序生成 Top 3
  - [ ] 实现 Top 10/20/50 扩展功能
  - [ ] 添加排名变化历史追踪
  - [ ] 实现新星 hashtag 检测

### 3.4 数据统计和缓存
- [ ] **实时统计计算**
  - [ ] 总 hashtag 数、总提及次数等基础统计
  - [ ] 国家/地区分布统计
  - [ ] 时间维度统计分析
  - [ ] 异常数据检测和处理

- [ ] **数据缓存策略**
  - [ ] Redis 缓存配置和实现
  - [ ] 热力图数据缓存策略
  - [ ] Top 3 hashtag 缓存
  - [ ] 缓存失效和更新机制

---

## 📋 阶段四：前端 Hashtag 分析界面

### 4.1 核心组件开发
- [ ] **TopHashtags 组件**
  - [ ] 显示 Top 3 trending hashtags
  - [ ] 展示提及次数和增长率
  - [ ] 添加 "See Top Videos" 按钮
  - [ ] 实现响应式布局

- [ ] **HeatmapTable 组件**
  - [ ] 7天热力图表格展示
  - [ ] 4级活动级别颜色显示
  - [ ] 悬停显示详细数据 tooltip
  - [ ] 滚动条和响应式处理

- [ ] **FilterBar 组件**
  - [ ] 国家/地区选择器（美国锁定为免费版）
  - [ ] 时间范围选择器（7天/30天/90天）
  - [ ] 排序方式选择（提及次数/增长率/新兴）
  - [ ] Apply Filters 按钮

### 4.2 数据可视化
- [ ] **热力图实现**
  - [ ] 定义 4 级颜色方案
  - [ ] 实现动态颜色计算
  - [ ] 添加悬停动画效果
  - [ ] 优化大数据量渲染性能

- [ ] **趋势指标显示**
  - [ ] 趋势上升/下降图标
  - [ ] 增长率百分比显示
  - [ ] 7天得分展示
  - [ ] 排名变化指示器

### 4.3 用户交互功能
- [ ] **筛选和排序**
  - [ ] 实时 hashtag 搜索
  - [ ] 多维度排序功能
  - [ ] 筛选条件组合应用
  - [ ] 状态保持和恢复

- [ ] **详情和操作**
  - [ ] View Details 按钮功能
  - [ ] See Top Videos 链接
  - [ ] Hashtag 详情弹窗
  - [ ] 数据导出功能（付费版）

---

## 📋 阶段五：Dashboard 主页面实现

### 5.1 页面布局和结构
- [ ] **整体布局实现**
  - [ ] 头部导航栏（Logo、导航菜单、用户头像）
  - [ ] Dashboard 标题区域
  - [ ] 筛选工具栏
  - [ ] 主要内容区域
  - [ ] 页脚区域

- [ ] **响应式设计实现**
  - [ ] 移动端适配（单列布局）
  - [ ] 平板端适配（双列布局）
  - [ ] 桌面端适配（完整布局）
  - [ ] 触摸交互优化

### 5.2 主题和样式
- [ ] **暗色模式支持**
  - [ ] 实现亮色/暗色主题切换
  - [ ] 主题状态本地存储
  - [ ] 系统主题自动检测
  - [ ] 主题切换动画效果

- [ ] **Tailwind 配置优化**
  - [ ] 定义热力图颜色变量
  - [ ] 配置响应式断点
  - [ ] 自定义组件样式
  - [ ] 动画效果配置

### 5.3 性能优化
- [ ] **页面加载优化**
  - [ ] 代码分割和懒加载
  - [ ] 图片优化和CDN
  - [ ] 字体优化
  - [ ] 首屏加载时间优化

- [ ] **数据渲染优化**
  - [ ] React.memo 组件优化
  - [ ] useMemo 数据缓存
  - [ ] 虚拟滚动（大数据量时）
  - [ ] 防抖搜索优化

---

## 📋 阶段六：商业化功能实现

### 6.1 功能权限控制
- [ ] **免费版限制**
  - [ ] 仅支持美国地区数据
  - [ ] 仅限7天历史数据
  - [ ] 基础热力图功能
  - [ ] Top 3 hashtag 展示

- [ ] **付费版功能**
  - [ ] 多国家/地区数据支持
  - [ ] 30天/90天历史数据
  - [ ] 高级筛选和排序
  - [ ] 数据导出功能（CSV/JSON）
  - [ ] Top 10/20/50 hashtag 查看

- [ ] **企业版功能**
  - [ ] API 数据访问接口
  - [ ] 自定义时间范围
  - [ ] 白标解决方案
  - [ ] 专属数据分析报告

### 6.2 用户认证和管理
- [ ] **基础用户系统**
  - [ ] Google OAuth 集成
  - [ ] 用户资料管理
  - [ ] 订阅状态管理
  - [ ] 使用量统计

- [ ] **订阅管理**
  - [ ] Stripe 支付集成
  - [ ] 月度/年度订阅选项
  - [ ] 自动续费处理
  - [ ] 试用期管理

### 6.3 功能门控实现
- [ ] **前端功能限制**
  - [ ] 基于用户权限的条件渲染
  - [ ] 付费功能 upsale 提示
  - [ ] 功能解锁弹窗
  - [ ] 使用量进度条

- [ ] **后端 API 限制**
  - [ ] JWT 认证中间件
  - [ ] 用户权限验证
  - [ ] API 调用频率限制
  - [ ] 数据访问权限检查

---

## 📋 阶段七：部署和运维

### 7.1 生产环境部署
- [ ] **服务器配置**
  - [ ] 选择云服务提供商（AWS/阿里云）
  - [ ] 配置生产环境服务器
  - [ ] 数据库服务器配置
  - [ ] CDN 配置和优化

- [ ] **CI/CD 流程**
  - [ ] 自动化测试流程
  - [ ] 自动化部署脚本
  - [ ] 环境变量管理
  - [ ] 回滚机制设计

### 7.2 监控和日志
- [ ] **系统监控**
  - [ ] 服务器性能监控
  - [ ] 数据库性能监控
  - [ ] API 调用监控
  - [ ] 用户行为分析

- [ ] **日志管理**
  - [ ] 结构化日志设计
  - [ ] 日志收集和分析
  - [ ] 错误追踪和告警
  - [ ] 性能分析报告

### 7.3 备份和恢复
- [ ] **数据备份策略**
  - [ ] 数据库定期备份
  - [ ] 文件系统备份
  - [ ] 配置文件备份
  - [ ] 备份验证机制

- [ ] **灾难恢复**
  - [ ] 恢复流程设计
  - [ ] 故障转移机制
  - [ ] 数据一致性保证
  - [ ] 恢复测试验证

---

## 🎯 MVP 开发优先级建议

### 第一优先级（核心MVP）
1. **YouTube Data API 集成** - 获取热门视频数据
2. **Hashtag 提取算法** - 从视频数据中提取和分析 hashtag
3. **热力图数据计算** - 生成7天活动热力图数据
4. **前端核心组件** - TopHashtags、HeatmapTable、FilterBar
5. **Dashboard 页面** - 实现设计稿中的主页面布局

### 第二优先级（功能完善）
6. **数据库设计和实现** - 存储hashtag统计数据
7. **定时任务系统** - 12小时数据同步机制
8. **性能优化** - 缓存和渲染优化
9. **响应式适配** - 移动端和平板端适配

### 第三优先级（商业化）
10. **免费版功能限制** - 7天数据和美国地区限制
11. **付费功能设计** - 订阅系统和功能解锁
12. **用户认证系统** - Google OAuth 集成
13. **数据导出功能** - CSV/JSON 导出（付费版）

### 第四优先级（运维和扩展）
14. **生产环境部署** - Vercel/Netlify 部署
15. **监控和日志** - 错误追踪和性能监控
16. **API 接口开发** - 企业版数据访问接口
17. **高级分析功能** - 预测和趋势分析

## 📅 预估时间线

- **MVP 版本**: 4-6周
- **功能完善版**: 8-10周
- **商业化版本**: 12-16周
- **完整企业版**: 16-20周

## 🚀 技术实现重点

1. **Hashtag 算法优化** - 确保准确性和性能
2. **热力图渲染性能** - 处理大量数据点
3. **实时数据更新** - 定时任务和数据同步
4. **用户体验设计** - 完全按照设计稿实现
5. **商业化功能集成** - 无缝的功能门控体验

---

## 📝 注意事项

1. **API 配额管理**：严格控制 YouTube API 调用量，避免超限
2. **数据隐私合规**：确保用户数据收集和使用符合相关法规
3. **性能优化**：大数据量场景下注意查询和渲染性能
4. **错误处理**：完善的错误处理和用户反馈机制
5. **测试覆盖**：关键功能需要有完整的测试覆盖
6. **文档维护**：及时更新技术文档和用户手册

---

**开始时间**: 2024年
**预计完成时间**: 3-6个月
**技术栈**: Next.js 14, TypeScript, PostgreSQL, Redis, YouTube Data API v3